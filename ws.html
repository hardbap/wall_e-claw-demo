<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>WebSocket test</title>
  </head>
  <body>

    <h1>WebSocket test</h1>

    <input type="range" id="claw-slider" step="1" min="60" max="144" value="60" />

    <input type="range" id="pan-slider" step="1" min="0" max="180" value="90" />

    <ul></ul>

    <script type="text/javascript">
      var logger      = document.getElementsByTagName('ul')[0],
          Socket      = window.MozWebSocket || window.WebSocket,
          url         = 'ws://' + location.hostname + ':' + location.port + '/',
          socket      = new Socket(url),
          clawSlider  = document.getElementById('claw-slider'),
          panSlider   = document.getElementById('pan-slider'),
          handler     = function(e) { socket.send(e.target.value); };

      var log = function(text) {
        logger.innerHTML += '<li>' + text + '</li>';
      };

      socket.addEventListener('open', function() {
        log('OPEN');
      });

      socket.onerror = function(event) {
        log('ERROR: ' + event.message);
      };

      socket.onmessage = function(event) {
        // log('MESSAGE: ' + event.data);
      };

      socket.onclose = function(event) {
        log('CLOSE: ' + event.code + ', ' + event.reason);
      };

      clawSlider.addEventListener('change', handler);
      panSlider.addEventListener('change', handler);

    </script>
  </body>
</html>
